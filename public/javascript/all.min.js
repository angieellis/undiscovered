// function checkAuth(){gapi.auth.authorize({client_id:OAUTH2_CLIENT_ID,scope:OAUTH2_SCOPES,immediate:!0},handleAuthResult)}function handleAuthResult(e){e&&!e.error?($(".pre-auth").hide(),$(".post-auth").show(),loadAPIClientInterfaces()):$("#login-link").click(function(){gapi.auth.authorize({client_id:OAUTH2_CLIENT_ID,scope:OAUTH2_SCOPES,immediate:!1},handleAuthResult)})}function loadAPIClientInterfaces(){gapi.client.load("youtube","v3",function(){handleAPILoaded()})}function initialize(){geocoder=new google.maps.Geocoder;var e=new google.maps.LatLng(-34.397,150.644),t={zoom:8,center:e};map=new google.maps.Map(document.getElementById("map-canvas"),t)}function codeAddress(){console.log(markers_array);var e=document.getElementById("address").value;geocoder.geocode({address:e},function(e,t){if(t==google.maps.GeocoderStatus.OK){console.log(e),map.setCenter(e[0].geometry.location);var o=new google.maps.Marker({map:map,position:e[0].geometry.location,draggable:!0});markers_array.push(o),markers_array.forEach(function(e){console.log(e.position.A),console.log(e.position.F)}),google.maps.event.addListener(o,"dragend",function(e){document.getElementById("latitude").value=e.latLng.lat(),document.getElementById("longitude").value=e.latLng.lng()})}else alert("Geocode was not successful for the following reason: "+t)})}require("dotenv").load();var OAUTH2_CLIENT_ID=process.env.OAUTH2_CLIENT_ID,OAUTH2_SCOPES=[process.env.OAUTH2_SCOPES];googleApiClientReady=function(){gapi.auth.init(function(){window.setTimeout(checkAuth,1)})},$(document).on("ready",function(){console.log("Client.js")});var DRIVE_UPLOAD_URL="https://www.googleapis.com/upload/drive/v2/files/",RetryHandler=function(){this.interval=1e3,this.maxInterval=6e4};RetryHandler.prototype.retry=function(e){setTimeout(e,this.interval),this.interval=this.nextInterval_()},RetryHandler.prototype.reset=function(){this.interval=1e3},RetryHandler.prototype.nextInterval_=function(){var e=2*this.interval+this.getRandomInt_(0,1e3);return Math.min(e,this.maxInterval)},RetryHandler.prototype.getRandomInt_=function(e,t){return Math.floor(Math.random()*(t-e+1)+e)};var MediaUploader=function(e){var t=function(){};if(this.file=e.file,this.contentType=e.contentType||this.file.type||"application/octet-stream",this.metadata=e.metadata||{title:this.file.name,mimeType:this.contentType},this.token=e.token,this.onComplete=e.onComplete||t,this.onProgress=e.onProgress||t,this.onError=e.onError||t,this.offset=e.offset||0,this.chunkSize=e.chunkSize||0,this.retryHandler=new RetryHandler,this.url=e.url,!this.url){var o=e.params||{};o.uploadType="resumable",this.url=this.buildUrl_(e.fileId,o,e.baseUrl)}this.httpMethod=e.fileId?"PUT":"POST"};MediaUploader.prototype.upload=function(){var e=new XMLHttpRequest;e.open(this.httpMethod,this.url,!0),e.setRequestHeader("Authorization","Bearer "+this.token),e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("X-Upload-Content-Length",this.file.size),e.setRequestHeader("X-Upload-Content-Type",this.contentType),e.onload=function(e){if(e.target.status<400){var t=e.target.getResponseHeader("Location");this.url=t,this.sendFile_()}else this.onUploadError_(e)}.bind(this),e.onerror=this.onUploadError_.bind(this),e.send(JSON.stringify(this.metadata))},MediaUploader.prototype.sendFile_=function(){var e=this.file,t=this.file.size;(this.offset||this.chunkSize)&&(this.chunkSize&&(t=Math.min(this.offset+this.chunkSize,this.file.size)),e=e.slice(this.offset,t));var o=new XMLHttpRequest;o.open("PUT",this.url,!0),o.setRequestHeader("Content-Type",this.contentType),o.setRequestHeader("Content-Range","bytes "+this.offset+"-"+(t-1)+"/"+this.file.size),o.setRequestHeader("X-Upload-Content-Type",this.file.type),o.upload&&o.upload.addEventListener("progress",this.onProgress),o.onload=this.onContentUploadSuccess_.bind(this),o.onerror=this.onContentUploadError_.bind(this),o.send(e)},MediaUploader.prototype.resume_=function(){var e=new XMLHttpRequest;e.open("PUT",this.url,!0),e.setRequestHeader("Content-Range","bytes */"+this.file.size),e.setRequestHeader("X-Upload-Content-Type",this.file.type),e.upload&&e.upload.addEventListener("progress",this.onProgress),e.onload=this.onContentUploadSuccess_.bind(this),e.onerror=this.onContentUploadError_.bind(this),e.send()},MediaUploader.prototype.extractRange_=function(e){var t=e.getResponseHeader("Range");t&&(this.offset=parseInt(t.match(/\d+/g).pop(),10)+1)},MediaUploader.prototype.onContentUploadSuccess_=function(e){200==e.target.status||201==e.target.status?this.onComplete(e.target.response):308==e.target.status&&(this.extractRange_(e.target),this.retryHandler.reset(),this.sendFile_())},MediaUploader.prototype.onContentUploadError_=function(e){e.target.status&&e.target.status<500?this.onError(e.target.response):this.retryHandler.retry(this.resume_.bind(this))},MediaUploader.prototype.onUploadError_=function(e){this.onError(e.target.response)},MediaUploader.prototype.buildQuery_=function(e){return e=e||{},Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")},MediaUploader.prototype.buildUrl_=function(e,t,o){var i=o||DRIVE_UPLOAD_URL;e&&(i+=e);var n=this.buildQuery_(t);return n&&(i+="?"+n),i},$(document).on("ready",function(){console.log("Init.js")});var geocoder,map,markers_array=[];google.maps.event.addDomListener(window,"load",initialize),$(document).ready(function(){$(".signinbox").hide(),$(".signupbox").hide(),$(".signin").click(function(){console.log("a"),$(".signupbox").hide(),$(".signinbox").fadeIn()}),$(".signup").click(function(){$(".signinbox").hide(),$(".signupbox").fadeIn()}),$(".close").click(function(){$(".signinbox").hide(),$(".signupbox").hide()})});var signinCallback=function(e){if(e.access_token){var t=new UploadVideo;t.ready(e.access_token)}},STATUS_POLLING_INTERVAL_MILLIS=6e4,UploadVideo=function(){this.tags=["youtube-cors-upload"],this.categoryId=22,this.videoId="",this.uploadStartTime=0};UploadVideo.prototype.ready=function(e){this.accessToken=e,this.gapi=gapi,this.authenticated=!0,this.gapi.client.request({path:"/youtube/v3/channels",params:{part:"snippet",mine:!0},callback:function(e){e.error?console.log(e.error.message):($("#channel-name").text(e.items[0].snippet.title),$("#channel-thumbnail").attr("src",e.items[0].snippet.thumbnails["default"].url),$(".pre-sign-in").hide(),$(".post-sign-in").show())}.bind(this)}),$("#button").on("click",this.handleUploadClicked.bind(this))},UploadVideo.prototype.uploadFile=function(e){var t={snippet:{title:$("#title").val(),description:$("#description").text(),tags:this.tags,categoryId:this.categoryId},status:{privacyStatus:$("#privacy-status option:selected").text()}},o=new MediaUploader({baseUrl:"https://www.googleapis.com/upload/youtube/v3/videos",file:e,token:this.accessToken,metadata:t,params:{part:Object.keys(t).join(",")},onError:function(e){var t=e;try{var o=JSON.parse(e);t=o.error.message}finally{alert(t)}}.bind(this),onProgress:function(e){var t=Date.now(),o=e.loaded,i=e.total,n=(o/((t-this.uploadStartTime)/1e3),100*o/i);$("#upload-progress").attr({value:o,max:i}),$("#percent-transferred").text(n),$("#bytes-transferred").text(o),$("#total-bytes").text(i),$(".during-upload").show()}.bind(this),onComplete:function(e){var t=JSON.parse(e);this.videoId=t.id,$("#video-id").text(this.videoId),$(".post-upload").show(),this.pollForVideoStatus()}.bind(this)});this.uploadStartTime=Date.now(),o.upload()},UploadVideo.prototype.handleUploadClicked=function(){$("#button").attr("disabled",!0),this.uploadFile($("#file").get(0).files[0])},UploadVideo.prototype.pollForVideoStatus=function(){this.gapi.client.request({path:"/youtube/v3/videos",params:{part:"status,player",id:this.videoId},callback:function(e){if(e.error)console.log(e.error.message),setTimeout(this.pollForVideoStatus.bind(this),STATUS_POLLING_INTERVAL_MILLIS);else{var t=e.items[0].status.uploadStatus;switch(t){case"uploaded":$("#post-upload-status").append("<li>Upload status: "+t+"</li>"),setTimeout(this.pollForVideoStatus.bind(this),STATUS_POLLING_INTERVAL_MILLIS);break;case"processed":$("#player").append(e.items[0].player.embedHtml),$("#post-upload-status").append("<li>Final status.</li>");break;default:$("#post-upload-status").append("<li>Transcoding failed.</li>")}}}.bind(this)})};